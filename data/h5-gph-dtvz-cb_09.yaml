- en: Chapter 9. Using Google Maps
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第9章。使用Google地图
- en: 'In this chapter we will cover:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖：
- en: Creating a geographic chart with the Google Visualization API
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Google Visualization API创建地理图表
- en: Obtaining a Google API key
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 获取Google API密钥
- en: Building a Google map
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建Google地图
- en: Adding markers and events
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加标记和事件
- en: Customizing controls and overlapping maps
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自定义控件和重叠地图
- en: Redesigning maps using styles
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用样式重新设计地图
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍
- en: This chapter will be dedicated to exploring some of the features available on
    Google Maps to get us ready to work with mapping in general. Mapping on its own
    isn't data visualization, but after we establish our base by understanding how
    to work with maps, we will have a very stable background that will enable us to
    create many cutting-edge, cool projects by integrating data and data visualization.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将致力于探索Google地图上的一些功能，以便让我们准备好处理地图工作。单独的地图并不是数据可视化，但是在我们通过了解如何处理地图来建立基础之后，我们将能够通过整合数据和数据可视化来创建许多尖端、酷炫的项目。
- en: In this chapter, we will explore the main ways to create maps in the Google
    sphere.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探索在Google领域创建地图的主要方法。
- en: Creating a geographic chart with Google Visualization API
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Google Visualization API创建地理图表
- en: In our first recipe for this chapter, we will start working with a vector-based
    map of the world. We will use it to highlight countries based on a data feed.
    In our case, we will use Wikipedia's list of countries as per the intentional
    homicide rate (latest numbers).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的第一个配方中，我们将开始使用基于矢量的世界地图。我们将用它来根据数据源突出显示国家。在我们的情况下，我们将使用维基百科的国家列表，根据故意谋杀率（最新数据）。
- en: To view this raw data go to [http://en.wikipedia.org/wiki/List_of_countries_by_intentional_homicide_rate](http://en.wikipedia.org/wiki/List_of_countries_by_intentional_homicide_rate).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看原始数据，请访问[http://en.wikipedia.org/wiki/List_of_countries_by_intentional_homicide_rate](http://en.wikipedia.org/wiki/List_of_countries_by_intentional_homicide_rate)。
- en: Our goal will be to have a map of the world highlighted with a range of colors
    according to the number of intentional homicides per 100,000 people. As of the
    latest data in 2012 according to Wikipedia, it sounds like the most unsafe place
    to live in is Honduras—if you don't want to be intentionally killed—while you
    should feel really safe from intentional killing in Japan. How is your country
    doing? Mine is not that bad. I should probably avoid my local news stations that
    make me feel like I'm living in a war zone.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标是拥有一张世界地图，根据每10万人中故意谋杀的数量而突出显示一系列颜色。根据维基百科2012年的最新数据，它听起来像是最不安全的地方是洪都拉斯——如果你不想被故意杀害的话——而在日本你应该感到非常安全。你的国家怎么样？我的国家还不错。我可能应该避开让我感觉自己生活在战区的当地新闻台。
- en: '![Creating a geographic chart with Google Visualization API](img/3707OT_09_01.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![使用Google Visualization API创建地理图表](img/3707OT_09_01.jpg)'
- en: Getting ready
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: There isn't much that you need to do. We will be using the Google Visualization
    API for creating a geographic chart.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 不需要做太多事情。我们将使用Google Visualization API来创建地理图表。
- en: How to do it...
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'We will create a new HTML and a new JavaScript file and call them `08.01.geo-chart.html`
    and `08.01.geo-chart.js`. Follow these steps:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将创建一个新的HTML和一个新的JavaScript文件，并将它们命名为`08.01.geo-chart.html`和`08.01.geo-chart.js`。按照以下步骤进行：
- en: 'In the HTML file add the following code:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在HTML文件中添加以下代码：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Let''s move to the `js` file. This time around we will want to request from
    the Google Visualization package the `geochart` functionality. To do that we will
    start our code, as follows:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们转到`js`文件。这一次，我们将要求从Google Visualization包中请求`geochart`功能。为此，我们将从以下代码开始：
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'We''ll then add a callback that will trigger the `init` function when the package
    is ready:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后我们将添加一个回调，当包准备就绪时将触发`init`函数：
- en: '[PRE2]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Now it''s time to add the logic within the `init` function. In the first step,
    we will format the data from Wikipedia to another format that will work for the
    Google Visualization API:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在是时候在`init`函数中添加逻辑了。在第一步中，我们将从维基百科格式化数据为另一种格式，以便适用于Google Visualization API：
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Let''s configure our chart options:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们配置我们的图表选项：
- en: '[PRE4]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Last but definitely not the least, let''s create our chart:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后但绝不是最不重要的，让我们创建我们的图表：
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: When you load the HTML file, you will find the countries of the world with highlighted
    colors that reflect the homicide rate. (We don't have a full list of all the countries
    of the world, and some countries are so small that it will be hard to find them.)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 当您加载HTML文件时，您会发现世界各国以反映谋杀率的突出颜色显示出来。（我们没有所有世界国家的完整列表，有些国家太小，很难找到它们。）
- en: How it works...
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The logic of this recipe is very simple, so let''s quickly dash through it
    and add some extra features. As in all the other visualization charts, there are
    three separate steps:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这个配方的逻辑非常简单，所以让我们快速浏览一下，并添加一些额外的功能。与所有其他可视化图表一样，有三个单独的步骤：
- en: Defining the data source
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义数据源
- en: Setting up the chart
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置图表
- en: Drawing the chart
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绘制图表
- en: Not all countries are alike. If you are having issues while working with a country
    that is outlined, search through the latest Google documents on the supported
    countries. For the full list, you can check the sheet available at [http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html](http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html).
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有国家都是相同的。如果您在处理一个有轮廓的国家时遇到问题，请搜索最新的Google文档，了解支持的国家。您可以在[http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html](http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html)上查看完整列表。
- en: There's more...
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Let's add some extra customization to our chart. As with all Google Visualization
    library elements, we can control many visuals through the `options` object.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们对我们的图表添加一些额外的自定义。与所有Google Visualization库元素一样，我们可以通过`options`对象控制许多可视化效果。
- en: 'The green color highlighted in our map just seems wrong. You would think that
    the less the killings the greener a country would be, so where the killings are
    more, a darker shade of red would be more appropriate. So let''s change the colors
    by updating the `options` object:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 我们地图中突出显示的绿色看起来不对。你会认为杀戮越少，一个国家就会越绿，所以在杀戮更多的地方，更深的红色更合适。所以让我们通过更新`options`对象来改变颜色：
- en: '[PRE6]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![There''s more...](img/3707OT_09_02.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![还有更多...](img/3707OT_09_02.jpg)'
- en: Making smaller areas more visible
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使较小的区域更可见
- en: 'To solve the problem of really small invisible countries, we can switch our
    rendering to be marker based. Instead of highlighting the land itself, we can
    switch to a marker-based rendering mode:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决真正小的不可见的国家的问题，我们可以将我们的渲染切换为基于标记的。我们可以切换到基于标记的渲染模式，而不是突出显示土地本身：
- en: '[PRE7]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'By default when rendering visualization maps with markers, when you roll over
    condensed areas, a highlight zoom view will help create a clearer view:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，当使用标记渲染可视化地图时，当您在压缩区域上滚动时，高亮的缩放视图将帮助创建更清晰的视图：
- en: '![Making smaller areas more visible](img/3707OT_09_03.jpg)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![使较小的区域更可见](img/3707OT_09_03.jpg)'
- en: 'Another option instead would be to zoom into the area (we can do both or just
    zoom in). To zoom into an area we will use this code:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选择是放大到该区域（我们可以两者都做，或者只是放大）。要放大到一个区域，我们将使用这段代码：
- en: '[PRE8]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To find out the list of possible values, refer back to the list of countries
    from earlier in this chapter. In this case we are zooming into the `MX` region:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解可能的值列表，请参阅本章前面的国家列表。在这种情况下，我们正在放大到`MX`地区：
- en: '![Making smaller areas more visible](img/3707OT_09_04.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![使较小的区域更可见](img/3707OT_09_04.jpg)'
- en: That covers the basics of working with a geographical chart. For more information
    on working with the Google Visualization API, please refer back to [Chapter 8](ch08.html
    "Chapter 8. Playing with Google Charts"), *Playing with Google Charts*.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 这涵盖了使用地理图表的基础知识。有关使用Google Visualization API的更多信息，请参阅[第8章](ch08.html "第8章。玩转Google图表")*玩转Google图表*。
- en: Obtaining a Google API key
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取Google API密钥
- en: To work with most of the Google APIs, you must have a Google API key. As such
    we will go through the steps involved in getting a Google API key.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用大多数Google API，你必须有一个Google API密钥。因此，我们将介绍获取Google API密钥所涉及的步骤。
- en: Google API has certain limitations and constraints. Although most of the APIs
    are free to use for small- to medium-sized sites, you are bound by some rules.
    Please refer to each library for its rules and regulations.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: Google API有一些限制和约束。尽管大多数API对于中小型网站是免费的，但你仍然受到一些规则的约束。请参考每个库的规则和条例。
- en: Getting ready
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To get through this recipe you must have a Google ID; if you do not have one,
    you will need to create one.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成这个示例，你必须有一个Google ID；如果你没有，你需要创建一个。
- en: How to do it...
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Let''s list the steps required to gain access to the Google API:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们列出获得访问Google API所需步骤：
- en: Log in to the API console at [https://code.google.com/apis/console](https://code.google.com/apis/console).
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到[https://code.google.com/apis/console](https://code.google.com/apis/console)的API控制台。
- en: Select the **Services** option from the left-hand side menu:![How to do it...](img/3707OT_09_05.jpg)
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从左侧菜单中选择**服务**选项：![操作步骤...](img/3707OT_09_05.jpg)
- en: Activate the API that you want to use (for example, in the next recipe *Building
    a Google map* we will use the Google Maps API v3 service):![How to do it...](img/3707OT_09_06.jpg)
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 激活你想要使用的API（例如，在下一个示例*构建Google地图*中，我们将使用Google Maps API v3服务）：![操作步骤...](img/3707OT_09_06.jpg)
- en: 'Again in the left-hand side menu select the **API Access** option. You will
    have to copy the **API key** and replace it in future Google API projects:     ![How to do it...](img/3707OT_09_07.jpg)'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 同样，在左侧菜单中选择**API访问**选项。您将需要复制**API密钥**并在将来的Google API项目中替换它：![操作步骤...](img/3707OT_09_07.jpg)
- en: This is the only time we will be talking about keys and permissions for working
    with the Google API platforms. Please validate that you have activated a key and
    also set the right libraries to be accessible to you.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们唯一一次讨论与Google API平台的密钥和权限有关的问题。请验证您已激活密钥，并设置正确的库以便您可以访问。
- en: How it works...
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: It's not hard to understand how this works. You just need to remember the steps
    as they will be the baseline of the future Google API interactions that we create.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 理解这是如何工作的并不难。你只需要记住这些步骤，因为它们将成为我们创建未来Google API交互的基础。
- en: As you must have noticed, there are many more API's in the Google library than
    we could even go through, but I do recommend that you scan through them and explore
    your options. In the next few recipes, we will be using the Google API to perform
    some mapping-related tasks.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你可能已经注意到的，Google库中有许多API，我们甚至无法全部涉及，但我建议你浏览一下并探索你的选择。在接下来的几个示例中，我们将使用Google
    API来执行一些与地图相关的任务。
- en: Building a Google map
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建Google地图
- en: Data and geography have a very natural relation. Data has more meaning when
    it's on a map. Using live maps is a very good option as it would enable the users
    to interact with a UI that is integrated with your own data presentations within
    the geographic area. In this recipe, we will integrate our first, real live map.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 数据和地理有着非常自然的关系。数据在地图上更有意义。使用实时地图是一个非常好的选择，因为它可以让用户与地理区域内集成了您自己数据呈现的UI进行交互。在这个示例中，我们将集成我们的第一个真实实时地图。
- en: Getting ready
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To get through this recipe, you must have a Google ID. If you do not have one,
    you will need to create one. Beyond that you will need to activate the Google
    Maps API v3 service in the API Console. For more information on this, please review
    the recipe *Obtaining a Google API key* discussed earlier in this chapter.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成这个示例，你必须有一个Google ID。如果你没有，你需要创建一个。除此之外，你还需要在API控制台中激活Google Maps API v3服务。有关更多信息，请参阅本章前面讨论的*获取Google
    API密钥*示例。
- en: 'Our goal will be to create a full-screen Google map that will be zoomed in
    and focused on France:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标是创建一个全屏的Google地图，将放大并聚焦在法国：
- en: '![Getting ready](img/3707OT_09_08.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![准备工作](img/3707OT_09_08.jpg)'
- en: How to do it...
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Let''s list the steps to create this sample. To create this sample we will
    create two files—a `.html` file and a `.js` file:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们列出创建此示例的步骤。要创建此示例，我们将创建两个文件——一个`.html`文件和一个`.js`文件：
- en: 'Let''s start with the HTML file. We''ll create a basic HTML file baseline for
    our project:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们从HTML文件开始。我们将为我们的项目创建一个基本的HTML文件基线：
- en: '[PRE9]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We will add to the HTML viewport information. This is the direction for mobile
    devices on how to render the page (this step can be skipped if you don''t care
    about accessing the maps in mobile devices):'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将添加HTML视口信息。这是移动设备如何呈现页面的指示（如果您不关心在移动设备上访问地图，可以跳过此步骤）：
- en: '[PRE10]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Add the style information into the header:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将样式信息添加到头部：
- en: '[PRE11]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Load in Google Maps v3 API (replace the bolded text with your API key):'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载Google Maps v3 API（用您的API密钥替换粗体文本）：
- en: '[PRE12]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Add the script source for our `09.03.googleJSmaps.js` JavaScript file:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加我们的`09.03.googleJSmaps.js` JavaScript文件的脚本源：
- en: '[PRE13]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Add an `onload` trigger that will call the `init` function (this is to be created
    in the next step):'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个`onload`触发器，将调用`init`函数（这将在下一步中创建）：
- en: '[PRE14]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'In the `09.03.googleJSmaps.js` JavaScript file, add the `init` function:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`09.03.googleJSmaps.js` JavaScript文件中，添加`init`函数：
- en: '[PRE15]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Load the HTML file, and you should find a full-screen roadmap zoomed into France.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载HTML文件，您应该会发现一个全屏幕的路线图缩放到法国。
- en: How it works...
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The most important and first step is loading the `maps` API. For Google to
    honor your request, you must have a valid API key. As such, don''t forget to replace
    the bolded text with your key:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 最重要和第一步是加载`maps` API。为了让Google满足您的请求，您必须拥有有效的API密钥。因此，请不要忘记用您的密钥替换粗体文本：
- en: '[PRE16]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Don't forget to use your own key. You might find yourself with a site that has
    a broken map. The `sensor` parameter in the URL is mandatory and must be set to
    `true` or `false`. If your map needs to know where the user location is, you must
    set it to `true`, and if not you may set it to `false`.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记使用您自己的密钥。您可能会发现自己的网站地图出现故障。URL中的`sensor`参数是强制性的，必须设置为`true`或`false`。如果您的地图需要知道用户位置在哪里，您必须将其设置为`true`，如果不需要，可以将其设置为`false`。
- en: 'Another interesting thing to note in our application is that it''s the first
    time we have used the viewport in our samples. As this topic is out of the scope
    of this book, I wanted to leave it. I know that many of you will end up using
    maps in mobile devices and will want to have the map default to a vertical/horizontal
    view. To learn more on how viewports work, check out the article available at:
    [https://developer.mozilla.org/en/Mobile/Viewport_meta_tag/](https://developer.mozilla.org/en/Mobile/Viewport_meta_tag/).'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的应用程序中另一个有趣的事情是，这是我们第一次在示例中使用视口。由于这个主题超出了本书的范围，我想留下来。我知道你们中的许多人最终会在移动设备上使用地图，并希望地图默认为垂直/水平视图。要了解更多有关视口如何工作的信息，请查看此处提供的文章：[https://developer.mozilla.org/en/Mobile/Viewport_meta_tag/](https://developer.mozilla.org/en/Mobile/Viewport_meta_tag/)。
- en: 'You must have noticed that we set many things in our CSS to be 100 percent,
    and as you probably guessed, it was for backward compatibility and validating
    that the map will fill the entire screen. If you just want to create a hard-set
    width/height, you may do so by replacing the CSS with the following code:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能已经注意到，我们在我们的CSS中设置了许多东西为100%，正如您可能猜到的那样，这是为了向后兼容性和验证地图将填满整个屏幕。如果您只想创建一个固定的宽度/高度，您可以通过用以下代码替换CSS来实现：
- en: '[PRE17]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: That covers the main things we need to do in the HTML file.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 这涵盖了我们在HTML文件中需要做的主要事情。
- en: There's more...
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'We haven''t yet covered the details of how the `init` function works. The basics
    of the `init` function are very simple. There are only two steps involved with
    creating a map. We need to know what `div` layer we want the map to be in and
    what options we want sent to our map:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还没有涵盖`init`函数如何工作的细节。`init`函数的基本原理非常简单。创建地图只涉及两个步骤。我们需要知道我们希望地图位于哪个`div`层，并且我们希望将哪些选项发送到我们的地图：
- en: '[PRE18]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Contrary to the Google Visualization API that had three steps in the last recipe,
    we can see that the Google `maps` API has only one step and within it we send
    the two options directly to be rendered (there is no step between creating and
    rendering).
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 与上一个配方中的Google可视化API有三个步骤不同，我们可以看到Google `maps` API只有一个步骤，在其中我们直接发送两个选项以进行渲染（在创建和渲染之间没有步骤）。
- en: Let's take a deeper look into the options as they are what will change the majority
    of the visuals and functionality of the map.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更深入地了解选项，因为它们将改变地图的大部分视觉和功能。
- en: Working with latitude and longitude
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用纬度和经度
- en: '**Latitude and longitude** (**lat/long**) is a coordinate system that divides
    the Earth into a grid-like pattern, making it easy to locate points on the Earth.
    The lat represents the vertical space while the long represents the horizontal
    space. It''s important to note that Google uses the World Geodetic System WGS84
    standard. There are other standards out there, so if you don''t use the same standard
    with your lat/long, you will find yourself at a different location from what you
    were originally looking for.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '**纬度和经度**（**lat/long**）是一种将地球划分为网格模式的坐标系统，使得在地球上定位点变得容易。纬度代表垂直空间，而经度代表水平空间。需要注意的是，谷歌使用世界大地测量系统WGS84标准。还有其他标准存在，所以如果你的纬度/经度不使用相同的标准，你会发现自己位于一个与最初寻找的位置不同的地方。'
- en: The easiest way to locate areas based on lat/long is through a helper tool on
    our map or through searching for the lat/long information of major cities.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 基于纬度/经度定位区域的最简单方法是通过我们地图上的辅助工具或搜索主要城市的纬度/经度信息。
- en: '[http://www.gorissen.info/Pierre/maps/googleMapLocation.php](http://www.gorissen.info/Pierre/maps/googleMapLocation.php)
    will help you locate a dot by clicking on the Google map directly. Another option
    in this category is to turn on the labs feature in the main Google Map site ([http://maps.google.com/](http://maps.google.com/)).
    In the main Google Map site on the bottom-left side of the screen, you will find
    **Map Labs**. In there you will find a few lat/long helpers.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.gorissen.info/Pierre/maps/googleMapLocation.php](http://www.gorissen.info/Pierre/maps/googleMapLocation.php)将帮助您直接在谷歌地图上点击以定位一个点。在此类别中的另一个选项是在主谷歌地图站点（[http://maps.google.com/](http://maps.google.com/)）上打开实验室功能。在屏幕左下角的主谷歌地图站点上，您会找到**地图实验室**。在那里，您会找到一些纬度/经度助手。'
- en: Or you can search the data per city by visiting [http://www.realestate3d.com/gps/latlong.htm](http://www.realestate3d.com/gps/latlong.htm).
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 或者您可以通过访问[http://www.realestate3d.com/gps/latlong.htm](http://www.realestate3d.com/gps/latlong.htm)按城市搜索数据。
- en: 'In our case when we are ready to make our pick, we will update the `options
    center` property to reflect where we want the map to be centered and adjust the
    zoom level until it feels right:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的情况下，当我们准备好做出选择时，我们将更新`options center`属性，以反映我们希望地图居中的位置，并调整缩放级别，直到感觉合适：
- en: '[PRE19]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Map types
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 地图类型
- en: 'There are many map types, and you can even create your own custom ones, but
    for our needs we will focus on the basic ones that are used most often:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多地图类型，甚至可以创建自定义的地图类型，但是对于我们的需求，我们将专注于最常用的基本类型：
- en: '`google.maps.MapTypeId.ROADMAP`: Displays the normal, default 2D tiles of Google
    maps'
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`google.maps.MapTypeId.ROADMAP`：显示谷歌地图的正常、默认的2D瓦片'
- en: '`google.maps.MapTypeId.SATELLITE`: Displays the photographic tiles'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`google.maps.MapTypeId.SATELLITE`：显示摄影瓦片'
- en: '`google.maps.MapTypeId.HYBRID`: Displays a mix of photographic tiles and a
    tile layer for prominent features (roads, city names, and so on)'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`google.maps.MapTypeId.HYBRID`：显示摄影瓦片和突出特征的瓦片图层（道路、城市名称等）'
- en: '`google.maps.MapTypeId.TERRAIN`: Displays physical relief tiles for displaying
    elevation and water features (mountains, rivers, and so on)'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`google.maps.MapTypeId.TERRAIN`：显示用于显示海拔和水体特征（山脉、河流等）的物理地形瓦片'
- en: This covers the basics that you need to know to get rolling with integrating
    maps onto a site.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 这涵盖了您需要了解的基础知识，以便将地图集成到网站上。
- en: Adding markers and events
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加标记和事件
- en: It's great that we have a map on our screen (assuming that you have followed
    the last recipe *Building a Google map*), but what about connecting data and integrating
    it into our map. I'm glad you asked about that, as this recipe will be our first
    step into adding data in the form of markers and events.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 我们屏幕上有地图很棒（假设您已经按照上一篇文章*构建谷歌地图*），但是如何连接数据并将其集成到我们的地图中呢。我很高兴你问到了这个问题，因为这篇文章将是我们第一步，将数据添加到标记和事件的形式中。
- en: In this sample, our goal is to place four markers in New York City. When the
    markers are clicked, we will zoom into that area and switch the map view type.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们的目标是在纽约市放置四个标记。当点击标记时，我们将放大到该区域并切换地图视图类型。
- en: '![Adding markers and events](img/3707OT_09_09.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![添加标记和事件](img/3707OT_09_09.jpg)'
- en: Getting ready
  id: totrans-123
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: At this stage, you should have created (at least once) a Google map by using
    the JS API; if you haven't, please revert back to the *Building a Google map*
    recipe.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，您应该已经使用JS API创建了（至少一次）谷歌地图；如果没有，请回到*构建谷歌地图*的步骤。
- en: How to do it...
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'We are not making any further changes in the HTML page created in the last
    recipe *Building a Google map*; as such we will focus our attention on the JavaScript
    file:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会在上一篇文章*构建谷歌地图*中创建的HTML页面中进行进一步的更改；因此，我们将把注意力集中在JavaScript文件上：
- en: 'Create an `init` function:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个`init`函数：
- en: '[PRE20]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Create map constants in the `base` state and then zoom in on the state:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`base`状态中创建地图常量，然后放大到该状态：
- en: '[PRE21]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Create the default map options:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建默认地图选项：
- en: '[PRE22]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Create a data source for our points:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为我们的点创建数据源：
- en: '[PRE23]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Loop through each array element and create a marker with an event that will
    zoom to the location, switch the view and pan to the correct location:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 循环遍历每个数组元素，并创建一个带有事件的标记，该事件将放大到该位置，切换视图并平移到正确的位置：
- en: '[PRE24]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Last but not the least, make the map clickable. So when the user clicks on
    the map, it should reset to its original state:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后但并非最不重要的是，使地图可点击。因此，当用户点击地图时，它应该重置为其原始状态：
- en: '[PRE25]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: When you run the application, you will find four markers on the screen. When
    you click on them, you will jump into a deeper zoom view. When you click on an
    empty area, it will take you back to the original view.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 当您运行应用程序时，您会在屏幕上找到四个标记。当您点击它们时，您将跳转到更深的缩放视图。当您点击空白区域时，它将带您回到原始视图。
- en: How it works...
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: Working with events and Google Maps is very easy. The steps involved always
    start from calling the static method `google.maps.event.addListener`. This function
    takes in three parameters, namely the item to be listened to, the event type (as
    a string), and a function.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 与事件和谷歌地图一起工作非常容易。所涉及的步骤始终从调用静态方法`google.maps.event.addListener`开始。此函数接受三个参数，即要监听的项目、事件类型（作为字符串）和一个函数。
- en: 'For example, in our `for` loop we create markers and then add events to them:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在我们的`for`循环中，我们创建标记，然后为它们添加事件：
- en: '[PRE26]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Instead we can create the event and then do not need to recreate a new anonymous
    function each time we loop through:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们可以创建事件，然后不需要每次循环时重新创建一个新的匿名函数：
- en: '[PRE27]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The advantage is really big. Instead of creating a function for each loop, we
    are using the same function throughout (smarter and smaller memory footprint).
    In our code, we are not mentioning any hardcoded values. Instead we are using
    the event information to get the `latLng` property. We can re-use the same function
    without any issue. By the way, you might have noticed that this is the first time
    that we put a named function inside another named function (`init` function).
    This isn't a problem and it works exactly the same way as the variable scopes
    work. In other words, this function that we created will have visibility only
    within the `init` function scope.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 优势真的很大。我们不是为每个循环创建一个函数，而是在整个过程中使用相同的函数（更智能，内存占用更小）。在我们的代码中，我们没有提及任何硬编码的值。相反，我们使用事件信息来获取`latLng`属性。我们可以毫无问题地重复使用相同的函数。顺便说一句，您可能已经注意到，这是我们第一次将一个命名函数放在另一个命名函数（`init`函数）中。这并不是问题，它的工作方式与变量作用域完全相同。换句话说，我们创建的这个函数只在`init`函数范围内可见。
- en: The creation of a marker is very simple; all we need to do is create a new `google.maps.Marker`
    and assign a position and a map to it. All other options are optional. (For a
    full list, please review the Google API documentation available at [https://developers.google.com/maps/documentation/javascript/reference#MarkerOptions](https://developers.google.com/maps/documentation/javascript/reference#MarkerOptions).)
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 创建标记非常简单；我们只需要创建一个新的`google.maps.Marker`并为其分配一个位置和一个地图。所有其他选项都是可选的。（有关完整列表，请查看[https://developers.google.com/maps/documentation/javascript/reference#MarkerOptions](https://developers.google.com/maps/documentation/javascript/reference#MarkerOptions)上可用的Google
    API文档。）
- en: There's more...
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: You might have noticed that we use the method `map.panTo`, but no panning actually
    happens and everything snaps to place. If you run the map, you will discover that
    we don't actually see any panning; that is because we are switching the map type,
    zooming out, and panning at the same time. Only panning can actually animate without
    a few tricks and bypasses, but all these steps make our application a lot more
    complex and the actual control over animation is very limited. We will come up
    with a solution to that in the next recipe as we use two maps instead of one in
    *Customizing controls and overlapping maps*. If we wanted we could add in a delay
    and do each step separately and animate the pan, but if we want to create a smooth
    transition, I would think about the idea of having two separate maps, one on top
    of each other instead, and fading in and out the main world map.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能已经注意到我们使用了`map.panTo`方法，但实际上没有发生平移，一切都会立即到位。如果运行地图，您会发现我们实际上并没有看到任何平移；这是因为我们同时切换了地图类型，缩小了地图，并进行了平移。只有平移可以在没有一些技巧和绕过的情况下实际动画化，但所有这些步骤使我们的应用程序变得更加复杂，对动画的实际控制非常有限。在下一个示例中，我们将提出一个解决方案，因为我们使用了两张地图而不是一张地图*自定义控件和重叠地图*。如果我们愿意，我们可以添加延迟并分别执行每个步骤并动画化平移，但如果我们想要创建一个平滑的过渡，我会考虑使用两张叠放在一起的地图，然后淡入和淡出主世界地图的想法。
- en: Customizing controls and overlapping maps
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自定义控件和重叠地图
- en: The goal of this recipe is to practice working with Google Maps. We will integrate
    what we learned about working with Google Maps in this chapter and incorporate
    our control over the user behaviors, such as what controllers the user can use,
    into it. We will start digging into creating our own unsupported undocumented
    behaviors, such as locking the users' pan area.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这个示例的目标是练习使用Google地图。我们将在本章学到的关于使用Google地图的知识，并将我们对用户行为的控制，例如用户可以使用哪些控制器，整合到其中。我们将开始挖掘创建我们自己不支持的未记录的行为，例如锁定用户的平移区域。
- en: Our main task in this recipe will be to take our work from the previous recipe,
    and instead of having the map zoom in and move around, create clean transitions
    between the zoomed in and zoomed out options; but as that isn't supported in a
    clean way through the interface, we will use external focuses. The idea is simple;
    we will stack up two maps on top of each other and fade in and out the top map,
    giving us total control over the fluidity of the transitions.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们的主要任务是将我们在上一个示例中的工作，而不是让地图放大和移动，而是在放大和缩小选项之间创建清晰的过渡；但由于界面不支持以清晰的方式进行，我们将使用外部焦点。这个想法很简单；我们将两张地图叠放在一起，淡入和淡出顶部地图，从而完全控制过渡的流畅性。
- en: Getting ready
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Even though we are starting from scratch, a lot of the work that we did in the
    last recipe is being re-used, so I strongly encourage you to go through the last
    recipe *Adding markers and events* before moving into this one.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们是从头开始的，但我们在上一个示例中所做的大部分工作都被重复使用，因此我强烈建议您在进入本示例之前先阅读上一个示例*添加标记和事件*。
- en: In this recipe, we will be integrating jQuery into our work as well, to save
    us time on creating our own animator tool (or re-using the one that we created
    in the *Animating independent layers* recipe in [Chapter 6](ch06.html "Chapter 6. Bringing
    Static Things to Life"), *Bringing Static Things to Life*), as it would take us
    away from our main topic.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们还将把jQuery整合到我们的工作中，以节省我们在创建自己的动画工具上的时间（或者重用我们在[第6章](ch06.html "第6章。将静态事物变得生动")中创建的动画独立图层的工具），因为这会让我们偏离主题。
- en: How to do it...
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'In this recipe we will be creating two files. An HTML file and a JS file. Let''s
    look into it, starting with the HTML file:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，我们将创建两个文件。一个HTML文件和一个JS文件。让我们来看看，从HTML文件开始：
- en: 'Create an HTML file and import the Google `maps` API and jQuery:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并导入Google `maps` API和jQuery：
- en: '[PRE28]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Use CSS to stack the map''s layers on top of each other:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用CSS将地图的图层堆叠在一起：
- en: '[PRE29]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Create the `09.05.controls.js` JS file and create an `init` function in it
    (from this point onwards the rest of the code will be in the `init` function):'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建`09.05.controls.js` JS文件，并在其中创建一个`init`函数（从这一点开始，其余的代码将在`init`函数中）：
- en: '[PRE30]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Create the two maps with their custom information:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建具有自定义信息的两张地图：
- en: '[PRE31]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Add the markers to the upper layer map:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将标记添加到上层地图：
- en: '[PRE32]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Add the `click` event to the internal map, and when you have clicked on it,
    you will be returned to the upper map:'
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`click`事件添加到内部地图，当您点击它时，将返回到上层地图：
- en: '[PRE33]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Force the user to disable `pan` in the upper map using the `center_changed`
    event:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`center_changed`事件强制用户禁用上层地图中的`pan`：
- en: '[PRE34]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: When you load the HTML file, you will find a fullscreen map that cannot be dragged.
    When you click on a marker, it will fade into the selected area. You can now drag
    the cursor around the map. The next time you click in the internal map (regular
    click on any area), the map will fade back to the original upper layer.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 当您加载HTML文件时，您会发现一个全屏地图，无法拖动。当您点击标记时，它将淡入所选区域。现在您可以在地图周围拖动光标。下次您在内部地图上点击（在任何区域上进行常规点击）时，地图将再次淡出到原始的上层。
- en: How it works...
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Our biggest step is the creation of two maps, one overlapping the other. We
    did that with some CSS magic by layering the elements and putting our top layer
    at the last position in the stack (we could probably use the z-index to validate
    it, but it worked so I didn't add that to the CSS). After that we created our
    two `div` layers and set their CSS code. In the JavaScript code, contrary to the
    way we did in the last recipe, we hardcoded the values that we wanted into both
    the maps.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们最大的一步是创建两个地图，一个重叠在另一个上面。我们通过一些CSS魔术来实现这一点，通过叠加元素并将我们的顶层放在堆栈的最后位置（我们可能可以使用z-index来验证它，但它有效，所以我没有将其添加到CSS中）。之后，我们创建了两个`div`层并设置了它们的CSS代码。在JavaScript代码中，与上一个示例中的方式相反，我们将我们想要的值硬编码到了两个地图中。
- en: 'In our options for both the maps, we set the default controllers not to take
    effect by setting the property `disableDefaultUI` to be `true`, while in `mapIn`
    we set `panControl` to be `true` to showcase that the map can be panned through:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 在两个地图的选项中，我们将通过将属性`disableDefaultUI`设置为`true`来设置默认控制器不生效，而在`mapIn`中，我们将`panControl`设置为`true`，以展示地图可以通过平移来移动：
- en: '[PRE35]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'We can manually set all the controllers by setting a Boolean value to any of
    the following options:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过将布尔值设置为以下任何选项来手动设置所有控制器：
- en: '`panControl`'
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`panControl`'
- en: '`zoomControl`'
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`zoomControl`'
- en: '`mapTypeControl`'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mapTypeControl`'
- en: '`streetViewControl`'
  id: totrans-181
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`streetViewControl`'
- en: '`overviewMapControl`'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`overviewMapControl`'
- en: 'Our `event` logic works in the exact same way that it did in the last recipe.
    The only change is within the actual listeners where we switch between the maps
    using jQuery:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的`event`逻辑与上一个示例中的逻辑完全相同。唯一的变化在于实际的监听器中，我们使用jQuery在地图之间进行切换：
- en: '[PRE36]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: In both the event for the markers and the `click` event of the map, we are using
    the `fadeIn` and `fadeOut` methods of jQuery to animate our external maps visibility.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在标记的事件和地图的`click`事件中，我们使用jQuery的`fadeIn`和`fadeOut`方法来动画显示我们外部地图的可见性。
- en: There's more...
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: When you try to drag around the higher-level map (the first visible map), you
    will notice that the map cannot move—it's not pannable. Google API v3 doesn't
    support the capability to disable the panning, but it does support the capability
    to get updated every time the map center point changes.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 当您尝试在高级地图（第一个可见地图）周围拖动时，您会注意到地图无法移动——它是不可平移的。Google API v3不支持禁用平移的功能，但它支持在地图中心点更改时每次获得更新。
- en: 'As such we listen in to the following change:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们监听以下更改：
- en: '[PRE37]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: All we are doing is that each time the map position changes, we force it back
    to its original position, making it impossible to move our map around.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 我们所做的就是每次地图位置发生变化时，强制将其恢复到原始位置，使我们的地图无法移动。
- en: Redesigning maps using styles
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用样式重新设计地图
- en: Many a time when creating more advanced applications by using Google Maps, you
    will want to create your own custom, skinned maps. This is really useful when
    you want to have a foreground content and don't want to have it compete with the
    background content.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用Google Maps创建更高级的应用程序时，您经常会希望创建自己的自定义样式地图。当您希望拥有前景内容并且不希望它与背景内容竞争时，这是非常有用的。
- en: In this recipe we will create a few styled maps. By the end of this recipe,
    you will know how to create global customization, individual styles, and last,
    but not least, add new map types.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在本示例中，我们将创建一些样式化地图。在本示例结束时，您将知道如何创建全局定制、个体样式，以及添加新地图类型。
- en: 'Here is one style that we will create:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将创建的一个样式：
- en: '![Redesigning maps using styles](img/3707OT_09_10.jpg)'
  id: totrans-195
  prefs: []
  type: TYPE_IMG
  zh: '![使用样式重新设计地图](img/3707OT_09_10.jpg)'
- en: 'And here is a second style that we will create:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将创建的第二个样式：
- en: '![Redesigning maps using styles](img/3707OT_09_11.jpg)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
  zh: '![使用样式重新设计地图](img/3707OT_09_11.jpg)'
- en: Getting ready
  id: totrans-198
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: To complete this recipe, you will have to start from a copy of the previous
    recipe. We will only describe the new steps that differ from the last example
    in this recipe. To view and understand all the steps, please read the *Customizing
    controls and overlapping maps* recipe.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成本示例，您需要从上一个示例的副本开始。我们只描述与本示例中上一个示例不同的新步骤。要查看和理解所有步骤，请阅读*自定义控件和重叠地图*示例。
- en: As such, we will skip the HTML code as it's exactly the same as in the previous
    recipe.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们将跳过HTML代码，因为它与上一个示例中的代码完全相同。
- en: How to do it...
  id: totrans-201
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'Open up your JavaScript file (`09.05.controls.js`) from the last recipe and
    follow these steps:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 打开上一个示例中的JavaScript文件（`09.05.controls.js`），并按照以下步骤操作：
- en: 'Within the `init` function create a `aVeinStyle` array. This array contains
    all the visual guides for skinning the map in the vein style:'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`init`函数中创建一个`aVeinStyle`数组。该数组包含了所有用于定制地图样式的视觉指南：
- en: '[PRE38]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Create a new `google.maps.StyledMapType` map with the name `Veins`:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个名为`Veins`的新`google.maps.StyledMapType`地图：
- en: '[PRE39]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Create a bus style:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个公交样式：
- en: '[PRE40]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'For the internal map, make the map-type controller visible and include in it
    the IDs for our new map styles:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于内部地图，使地图类型控制器可见，并在其中包括我们新地图样式的ID：
- en: '[PRE41]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Add the map style information into the `mapIn` object:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将地图样式信息添加到`mapIn`对象中：
- en: '[PRE42]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Set a default map type:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置默认地图类型：
- en: '[PRE43]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: When you restart the HTML file in the internal map (after clicking on one of
    the markers), you will find a controller menu that enables you to switch between
    custom map types.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 当您重新启动HTML文件中的内部地图（在单击标记中的一个后），您将找到一个控制器菜单，可以在自定义地图类型之间切换。
- en: How it works...
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Working with Google styles is fun, and they work in a way that is very similar
    to the way CSS works. The style we set has a few steps; the first step is to create
    the rules of the style, the next one is to define a Google-style object (`google.maps.StyledMapType`),
    and the last step is to define what map this style information is relevant to.
    Styles can only be applied to the maps of the `google.maps.MapTypeId.ROADMAP`
    type.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Google样式很有趣，它们的工作方式与CSS非常相似。我们设置的样式有几个步骤；第一步是创建样式的规则，下一步是定义一个Google样式对象（`google.maps.StyledMapType`），最后一步是定义这个样式信息与哪个地图相关联。样式只能应用于`google.maps.MapTypeId.ROADMAP`类型的地图。
- en: 'The first example is the creation of the bus style. The goal of this style
    is to make the map black and white and only highlight the public transportation
    stations:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个示例是创建公交车样式。这种样式的目标是使地图变成黑白色，并只突出显示公共交通站点：
- en: '[PRE44]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'The first variable is a regular array. We can add into it as many styles as
    we want; each time we want to define the rules (the search terms) that would apply
    before we actually list out the styles. Let''s take a deeper look at one style
    rule:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个变量是一个常规数组。我们可以添加任意多个样式；每次我们想要定义规则（搜索条件）之前，都会应用这些规则。让我们更深入地看一下一个样式规则：
- en: '[PRE45]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: This example is the most basic. We have no rule, or in other words we want to
    apply this style to everything. As in this example we are setting the saturation
    to `-100`, we are making everything black and white (saturation values by default
    are `0` and can take values between `-100` and `100`).
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子是最基本的。我们没有规则，或者换句话说，我们想将这种样式应用到所有东西上。就像在这个例子中，我们将饱和度设置为`-100`，我们正在使一切变成黑白色（饱和度默认值为`0`，可以取值在`-100`和`100`之间）。
- en: 'The possible style properties are as follows:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 可能的样式属性如下：
- en: '`visibility`: This is a string value (`no`, `off`, or `simplified`). This adds
    or removes elements from the map; for the most part, it would be used to remove
    text such as labels and details out of the elements depending on the information
    provided.'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`可见性`：这是一个字符串值（`no`，`off`或`simplified`）。这会向地图添加或移除元素；在大多数情况下，它将用于根据提供的信息删除文本，如标签和细节。'
- en: '`gamma`: This is a number value between `0.01` and `10` (`1.0` is the default).
    This option controls how much light is within the view. While lower values (lower
    than `1`) would sharpen the difference between lighter and darker colors, higher
    numbers (more than `1`) would have a more global effect, making everything glow
    more as the value goes up.'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`伽马`：这是一个介于`0.01`和`10`之间的数字值（默认值为`1.0`）。这个选项控制视图中有多少光。较低的值（低于`1`）会加强较浅和较暗颜色之间的差异，较高的数字（大于`1`）会产生更全局的效果，使一切随着数值的增加而更加发光。'
- en: '`hue`: This is a hexadecimal color value wrapped into a string (such as #`222222`).
    For the best way to describe what the hue does, imagine putting on sunglasses
    that have tinted glass that matches the provided hexadecimal value. The way the
    tinted glass affects the colors around you and changes them is the same way that
    the hue colors of the map change.'
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`色调`：这是一个十六进制颜色值，包装成字符串（例如#`222222`）。最好的描述色调的方式是，想象戴上与提供的十六进制值匹配的有色玻璃的太阳镜。有色玻璃如何影响你周围的颜色并改变它们的方式，就像地图的色调颜色改变的方式一样。'
- en: '`lightness`: This is a value between `-100` and `100` (the default is `0`).
    This effect is really simple if you provide a value lower than `0`. It''s the
    same effect as putting a black rectangle on top of your map and changing its opacity
    (that is, `-30` would match up to the opacity of 30 percent). You might have guessed
    the result of positive values—for positive values the idea is the same, but only
    with a white rectangle.'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`亮度`：这是一个介于`-100`和`100`之间的值（默认值为`0`）。如果提供一个小于`0`的值，这个效果就非常简单。这与在地图上放置一个黑色矩形并改变其不透明度的效果相同（即，`-30`将与30%的不透明度相匹配）。你可能已经猜到了正值的结果——对于正值，想法是一样的，但只是用一个白色矩形。'
- en: '`saturation`: This is a value between `-100` and `100` (the default is `0`).
    This effect focuses on a pixel-by-pixel value of `-100`. It would create grayscale
    image values that are nearer to `100`. It would remove all gray colors from the
    image, making everything more vivid.'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`饱和度`：这是一个介于`-100`和`100`之间的值（默认值为`0`）。这个效果侧重于像素级的值，`-100`会创建更接近`100`的灰度图像值。它会从图像中去除所有灰色，使一切更加生动。'
- en: 'This is all the style information that is available, and with it we can control
    every style element within the map. Each style property''s information needs to
    be sent as a separate object within the `stylers` array; for example, if we wanted
    to add a `hue` to our snippet, it would look like this:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是所有可用的样式信息，有了它，我们可以控制地图内的每个样式元素。每个样式属性的信息都需要作为`stylers`数组中的单独对象发送；例如，如果我们想要在我们的片段中添加一个`色调`，它会看起来像这样：
- en: '[PRE46]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Now that we know all the different ways in which we can change the visuals
    of the map, it''s time to understand how we''ll define what should be selected.
    In the last code snippet we''ve controlled the full map, but we can filter out
    what we want to control by adding filtering logic:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道了可以改变地图视觉效果的所有不同方式，是时候了解我们将如何定义应该被选择的内容。在最后的代码片段中，我们控制了整个地图，但我们可以通过添加过滤逻辑来过滤我们想要控制的内容：
- en: '[PRE47]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'In this snippet, we are filtering out that we want to change the color of all
    the `geometry` elements, which means that whatever isn''t a `geometry` element
    will not be affected. There are three types of element-type options:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个片段中，我们正在过滤我们想要改变所有`geometry`元素的颜色，这意味着不是`geometry`元素的任何东西都不会受到影响。有三种类型的元素类型选项：
- en: '`all` (the default option)'
  id: totrans-234
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`全部`（默认选项）'
- en: '`geometry`'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`几何`'
- en: '`labels`'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`标签`'
- en: 'There is one more way to filter information, by using the `featureType` property.
    For example:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一种过滤信息的方法，就是使用`featureType`属性。例如：
- en: '[PRE48]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: In this case, we are listing out exactly what we want to focus on. We want to
    focus on both the type of feature and the element type. If we were to extract
    the `elementType` property, our color effect would affect both `geometry` and
    `labels`. Whereas if we were to extract `featureType`, it would affect all the
    `geometry` elements in the map.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们正在列出我们想要关注的内容。我们想关注特征类型和元素类型。如果我们提取`elementType`属性，我们的颜色效果将影响`geometry`和`labels`。而如果我们提取`featureType`，它将影响地图中的所有`geometry`元素。
- en: For the full list of the `featureType` property options, please visit [http://goo.gl/H7HSO](http://goo.gl/H7HSO).
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 有关`featureType`属性选项的完整列表，请访问[http://goo.gl/H7HSO](http://goo.gl/H7HSO)。
- en: There's more...
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Now that we have under our belts how to create the styles we want to use, the
    next critical step is to actually connect our style to the map. The easiest way
    to do it (if we only have one style) is to connect it directly to the map:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经掌握了如何创建我们想要使用的样式，下一个关键步骤是实际将我们的样式与地图连接起来。最简单的方法（如果我们只有一个样式）是直接将其连接到地图上：
- en: '[PRE49]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: This can be done by calling the `setOptions` function or by adding the `style`
    property when we create our map. Styles can only be added to road maps, and as
    such if you add this style to a map that isn't a road map, it would not be applied.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 这可以通过调用`setOptions`函数或在创建地图时添加`style`属性来完成。样式只能添加到路线图中，因此如果将此样式添加到不是路线图的地图上，它将不会被应用。
- en: 'As we want to add more than one style option, we have to list out the map types.
    Before we can do that, we need to create a new map type object by using the following
    code:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们想要添加多个样式选项，我们必须列出地图类型。在这之前，我们需要使用以下代码创建一个新的地图类型对象：
- en: '[PRE50]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'While creating the new map, we provided a name that will be used as our name
    in a controller—if we choose to create a controller (in our example we do). It''s
    important to note that this name is not the ID of our element but just the label
    of the element, and we still need to create an ID for our element before sending
    it into the map. To do that we will first add the IDs into our controller and
    make our controller visible:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建新地图时，我们提供了一个名称，该名称将用作我们在控制器中的名称 - 如果我们选择创建一个控制器（在我们的示例中我们会这样做）。重要的是要注意，这个名称不是我们元素的ID，而只是元素的标签，我们仍然需要在将其发送到地图之前为我们的元素创建一个ID。为此，我们将首先将ID添加到我们的控制器中，并使我们的控制器可见：
- en: '[PRE51]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Following this, we will add the set instructions connecting our new map types
    to their style objects:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 在此之后，我们将添加设置指令，将我们的新地图类型连接到它们的样式对象：
- en: '[PRE52]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Last but not least, we can change our default map to be one of our styled maps:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 最后但同样重要的是，我们可以将默认地图更改为我们的样式地图之一：
- en: '[PRE53]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: There you go. You now know everything that you need to know about how to work
    with styles in Google Maps.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 就是这样。现在你已经知道了如何在谷歌地图中使用样式的所有必要信息。
